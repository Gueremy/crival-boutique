<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración | CRIVAL BOUTIQUE</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-pink: #fea6a2;
            --color-green: #8dccad;
            --color-yellow: #ffe9af;
            --color-blue: #f9d6ac;
            --color-text: #5c5241;
            --color-white: #fff;
            --color-dark-gray: #988864;
        }
        body { font-family: 'Poppins', sans-serif; margin: 0; padding: 0; background-color: #f4f4f9; color: var(--color-text); line-height: 1.6; display: flex; min-height: 100vh; }
        .sidebar { width: 250px; background-color: var(--color-blue); padding: 2rem 1rem; box-shadow: 2px 0 5px rgba(0,0,0,0.1); display: flex; flex-direction: column; align-items: center; flex-shrink: 0; }
        .sidebar-logo { font-size: 1.5rem; font-weight: 600; color: var(--color-text); text-align: center; margin-bottom: 2rem; border-bottom: 2px solid var(--color-green); padding-bottom: 1rem; width: 100%; }
        .sidebar-nav { width: 100%; }
        .sidebar-nav ul { list-style: none; padding: 0; margin: 0; }
        .sidebar-nav a { display: block; padding: 1rem; margin-bottom: 0.5rem; background-color: var(--color-pink); color: var(--color-text); text-decoration: none; font-weight: 400; border-radius: 8px; transition: background-color 0.3s ease, transform 0.2s ease; }
        .sidebar-nav a:hover { background-color: #e49894; transform: translateX(5px); }
        .main-content { flex-grow: 1; padding: 3rem; overflow-x: auto; }
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--color-green);
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
        }
        .dashboard-header h1 { font-size: 2.5rem; margin: 0; color: var(--color-text); }
        .section-card { background-color: var(--color-white); border-radius: 12px; padding: 2.5rem; margin-bottom: 2rem; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .section-card h2 { font-size: 1.8rem; color: var(--color-text); margin-top: 0; margin-bottom: 1.5rem; border-bottom: 2px solid var(--color-yellow); display: inline-block; padding-bottom: 0.5rem; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--color-dark-gray); }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 8px; font-family: 'Poppins', sans-serif; font-size: 1rem; box-sizing: border-box; background-color: #fcfcfc; }
        .btn-submit { background-color: var(--color-green); color: var(--color-text); padding: 0.8rem 2rem; border: none; border-radius: 50px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease; }
        .btn-submit:hover { background-color: #7cb89b; transform: translateY(-2px); }
        .data-table { width: 100%; border-collapse: collapse; margin-top: 1.5rem; }
        .data-table th, .data-table td { padding: 1rem; text-align: left; border-bottom: 1px solid #eee; }
        .data-table th { background-color: #f8f8f8; font-weight: 600; color: var(--color-dark-gray); }
        .table-img { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; }
        .action-buttons { display: flex; gap: 0.5rem; align-items: center; }
        .btn-edit, .btn-delete { text-decoration: none; padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.9rem; font-weight: 600; cursor: pointer; border: none; font-family: 'Poppins', sans-serif; transition: background-color 0.3s ease; }
        .btn-edit { background-color: var(--color-yellow); color: var(--color-text); }
        .btn-edit:hover { background-color: #e5d29e; }
        .btn-delete { background-color: #e74c3c; color: var(--color-white); }
        .btn-delete:hover { background-color: #c0392b; }
        .alert { padding: 1rem; margin-bottom: 1rem; border-radius: 8px; border: 1px solid transparent; }
        .alert-success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }
        .alert-warning { color: #856404; background-color: #fff3cd; border-color: #ffeeba; }

        /* --- Responsive Admin Layout --- */
        .admin-hamburger {
            display: none; /* Oculto en escritorio por defecto */
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            z-index: 1001;
        }
        .admin-hamburger span {
            display: block;
            width: 25px;
            height: 3px;
            background-color: var(--color-text);
            margin: 5px 0;
            transition: all 0.3s;
        }
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
            z-index: 999;
        }

        @media (max-width: 992px) {
            body { display: block; } /* Romper el layout flex para apilar verticalmente */
            .sidebar { position: fixed; height: 100%; top: 0; left: 0; z-index: 1000; transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
            .sidebar.is-active { transform: translateX(0); }
            .main-content { padding: 1.5rem; }
            .dashboard-header h1 { font-size: 1.8rem; }
            .admin-hamburger { display: block; }
            .overlay.is-active { display: block; }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-logo">CRIVAL ADMIN</div>
        <nav class="sidebar-nav">
            <ul>
                <li><a href="{{ url_for('admin') }}">Productos</a></li>
                <li><a href="{{ url_for('manage_categories') }}">Categorías</a></li>
                <li style="margin-top: 2rem; border-top: 1px solid #e4c19b; padding-top: 1rem;"><a href="{{ url_for('index') }}" target="_blank">Ver Sitio Público</a></li>
                <li><a href="{{ url_for('logout') }}">Cerrar Sesión</a></li>
            </ul>
        </nav>
    </aside>
    
    <main class="main-content">
        <header class="dashboard-header">
            <h1>Panel de Admin</h1>
            <button class="admin-hamburger" aria-label="Abrir menú">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category if category != 'message' else 'success' }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <section class="section-card">
            <h2>Agregar Nuevo Producto</h2>
            <form action="{{ url_for('admin') }}" method="post" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="name">Nombre del Producto</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="price">Precio (CLP)</label>
                    <input type="number" step="any" id="price" name="price" required>
                </div>
                <div class="form-group">
                    <label for="category_id">Categoría</label>
                    <select id="category_id" name="category_id" required>
                        {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="image">Imagen del Producto</label>
                    <input type="file" id="image" name="image" accept="image/*" required>
                </div>
                <div class="form-group">
                    <label for="description">Descripción</label>
                    <textarea id="description" name="description" rows="4" required></textarea>
                </div>
                <button type="submit" class="btn-submit">Agregar Producto</button>
            </form>
        </section>

        <section class="section-card">
            <h2>Listado de Productos</h2>
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Imagen</th>
                            <th>Nombre</th>
                            <th>Categoría</th>
                            <th>Precio</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in products %}
                        <tr>
                            <td><img src="{{ product.image }}" alt="{{ product.name }}" class="table-img"></td>
                            <td>{{ product.name }}</td>
                            <td>{{ category_map.get(product.category_id, 'N/A') }}</td>
                            <td>${{ "%.0f"|format(product.price|float) }}</td>
                            <td>
                                <div class="action-buttons">
                                    <a href="{{ url_for('edit_product', product_id=product.id) }}" class="btn-edit">Editar</a>
                                    <form action="{{ url_for('delete_product', product_id=product.id) }}" method="post" onsubmit="return confirm('¿Estás seguro de que quieres eliminar este producto?');" style="display: inline;">
                                        <button type="submit" class="btn-delete">Eliminar</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" style="text-align: center;">No hay productos para mostrar.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
    </main>
    <div class="overlay"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const hamburger = document.querySelector('.admin-hamburger');
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.overlay');

            function toggleMenu() {
                sidebar.classList.toggle('is-active');
                overlay.classList.toggle('is-active');
            }

            hamburger.addEventListener('click', toggleMenu);
            overlay.addEventListener('click', toggleMenu);
        });
    </script>
</body>
</html>